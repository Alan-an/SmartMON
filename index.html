<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Smartmon by mrsunlin</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Smartmon</h1>
        <h2>SmartMON is a Unix/Linux Infrastructure Monitor, all built on Standard Shell scripts. Already included powerful monitor functions for Oracle  9i/10g/11g databases and RACs. The whole system has been tested and smoothly monitored a very large Telecom Product System for several years , which have hundreds hosts and hundreds TB data stored in Oracle Database.</h2>

        <section id="downloads">
          <a href="https://github.com/mrsunlin/SmartMON/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/mrsunlin/SmartMON/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/mrsunlin/SmartMON" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a name="smartmon" class="anchor" href="#smartmon"><span class="octicon octicon-link"></span></a>SmartMON</h1>

<p><code>Author</code> <a href="https://www.facebook.com/mrsunlin">https://www.facebook.com/mrsunlin</a></p>

<p><code>Wiki</code> <a href="https://github.com/mrsunlin/SmartMON/wiki">https://github.com/mrsunlin/SmartMON/wiki</a></p>

<p><code>Website</code> <a href="http://mrsunlin.github.io/SmartMON">http://mrsunlin.github.io/SmartMON</a></p>

<h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>SmartMON is a Unix/Linux Infrastructure Monitor, all built on Standard Shell scripts. </p>

<p>Already included powerful monitor functions for Oracle  9i/10g/11g databases and RACs. </p>

<p>The whole system has been tested and smoothly monitored a very large Telecom Product System for several years , which have hundreds hosts and hundreds TB data stored in Oracle Database.</p>

<h1>
<a name="deployment" class="anchor" href="#deployment"><span class="octicon octicon-link"></span></a>Deployment</h1>

<p>It's very simple to deploy the product when the environment is prepared, only one line code in the crontab:</p>

<pre><code>crontab -e
* * * * * sh &lt;Path to the monitor directory&gt;/smartmon_agent
</code></pre>

<h2>
<a name="requirement" class="anchor" href="#requirement"><span class="octicon octicon-link"></span></a>Requirement</h2>

<h3>
<a name="hardware" class="anchor" href="#hardware"><span class="octicon octicon-link"></span></a>Hardware</h3>

<p>One PC Server is OK for monitoring one hundred of machines.</p>

<h3>
<a name="software" class="anchor" href="#software"><span class="octicon octicon-link"></span></a>Software</h3>

<p><code>OS:</code> Linux/Unix with FTP service</p>

<p><code>Database:</code> Oracle (9i or above)</p>

<h3>
<a name="network" class="anchor" href="#network"><span class="octicon octicon-link"></span></a>Network</h3>

<p>Only two ports of the server should be open to all of the monitored machines:</p>

<blockquote>
<p><code>21</code>, <code>1521</code></p>
</blockquote>

<h2>
<a name="define-the-parameters" class="anchor" href="#define-the-parameters"><span class="octicon octicon-link"></span></a>Define the parameters</h2>

<h3>
<a name="define-services-to-be-monitored" class="anchor" href="#define-services-to-be-monitored"><span class="octicon octicon-link"></span></a>Define Services to be monitored</h3>

<p>edit file <code>cmd.cfg</code>, define available services. Normally you won't need more than the default.</p>

<p>Each service is defined by 2 lines:</p>

<pre><code># tabdef;&lt;service name&gt;;&lt;col count&gt;;&lt;if partitioned by date 1 else 0&gt;;&lt;if partitioned by houer 1 else 0&gt;;&lt;partition count&gt;;[&lt;col name&gt;=&lt;col type]; ...]
# &lt;service name&gt;;&lt;platform name, * for all platform&gt;;&lt;execution interval in seconds&gt;;&lt;col count&gt;;&lt;group name&gt;;&lt;command&gt;
</code></pre>

<p>The first line define the table structure and data life cycle in database. The<code>&lt;col count&gt;</code> here should equal with <code>&lt;col count&gt;</code> in the command definition line, that's for the safe check. The <code>&lt;col type&gt;</code> is exactly the type in Oracle database.</p>

<p>The second line define the execution time cycle, and the process group. <code>&lt;execution interval in seconds&gt;</code> define the time cycle in seconds, if less than one minute, the actual interval is one minute. That's for the safety concern.</p>

<p><code>&lt;group name&gt;</code> define which process should the service use on the monitored machine, if multiple services share the same <code>&lt;group name&gt;</code>, they will be executed sequently in the same process, otherwise they will be executed separately. </p>

<p><code>&lt;command&gt;</code> define the command/Script to be executed by the service on the monitored machine. For simple command, it can be embedded in the <code>&lt;command&gt;</code>. For complex service which need to be done with scripts, the scripts should be stored in <code>scripts</code> directory, and in the <code>&lt;command&gt;</code> should have a line of command like <code>sh scripts/some_script_name</code></p>

<h3>
<a name="define-machines-to-be-monitored" class="anchor" href="#define-machines-to-be-monitored"><span class="octicon octicon-link"></span></a>Define machines to be monitored</h3>

<p>edit file <code>service.cfg</code>, each line defines a machine and the services on it.</p>

<p>The format is <code>hostname service1;service2;...;serviceN</code></p>

<h3>
<a name="define-the-database" class="anchor" href="#define-the-database"><span class="octicon octicon-link"></span></a>Define the database</h3>

<p>In <code>db_conn.cfg</code> file define two database users, they can reside in the same database or separately. </p>

<p>The <code>alert</code> database only stores the data no more than 2 hours, so that the alert system can detect events as soon as possible.</p>

<p>The <code>report</code> database stores data as much as the definition of services specified by <code>&lt;partition count&gt;</code>, but drop older data. That enable you analyze history events across machines in one pass.</p>

<p>Here is the example</p>

<pre><code>alert   sqlplus -s smartmon_alert/smartmon12@"(DESCRIPTION=(ADDRESS=(HOST=10.19.84.10)(PORT=1521)(PROTOCOL=TCP))(CONNECT_DATA=(SID=ols1)))"
report  sqlplus -s smartmon_report/smartmon12@"(DESCRIPTION=(ADDRESS=(HOST=10.19.84.10)(PORT=1521)(PROTOCOL=TCP))(CONNECT_DATA=(SID=ols1)))"
</code></pre>

<p>You can use external database(s), but you should make sure the monitored machines can access the <code>1521</code> port (Oracle Listener port) of the database(s)</p>

<h3>
<a name="define-the-release-path" class="anchor" href="#define-the-release-path"><span class="octicon octicon-link"></span></a>Define the release path</h3>

<p>The release path is defined in file <code>release_server.cfg</code>. The content contains only one line:</p>

<pre><code>ftp &lt;ip address&gt; 21 &lt;smartmon deployed os username&gt; &lt;password&gt; &lt;release path&gt;
</code></pre>

<p>the <code>&lt;release path&gt;</code> is a directory path which can be accessed by the smartmon OS user via FTP. </p>

<p>It is for every monitored machine to download the latest monitor package, to update their local definitions or scripts in no more than 1 minute when new package is released.</p>

<p>When anyone of the files with suffix <code>.cfg</code> or any script file in <code>scripts</code> directory is modified, simply execute command <code>sh release_agent</code> to distribute the package to all monitored machines.</p>

<h1>
<a name="event-alert--analyze" class="anchor" href="#event-alert--analyze"><span class="octicon octicon-link"></span></a>Event alert &amp; analyze</h1>

<p>This part is not finished yet</p>

<h2>
<a name="alert" class="anchor" href="#alert"><span class="octicon octicon-link"></span></a>Alert</h2>

<p>Override the file <code>smartmon_alert</code> to make your own alert system</p>

<h2>
<a name="analyze" class="anchor" href="#analyze"><span class="octicon octicon-link"></span></a>Analyze</h2>

<p>Currently, use SQL tools to access the <code>report</code> database to do analyze manually.</p>

<h1>
<a name="more" class="anchor" href="#more"><span class="octicon octicon-link"></span></a>More</h1>

<p>It's open to you to add more functions to the system, such as alert, analyze etc.</p>
      </section>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-41213979-10");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>